<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Securing Verifiable Credentials using JSON Web Tokens</title>
    <script
      src="https://www.w3.org/Tools/respec/respec-w3c"
      class="remove"
    ></script>
    <script class="remove">
      // See https://github.com/w3c/respec/wiki/ for how to configure ReSpec
      var respecConfig = {
        group: "vc",

        // specification status (e.g., WD, NOTE, etc.). If in doubt use ED.
        specStatus: "FPWD",

        // the specification's short name, as in http://www.w3.org/TR/short-name/
        shortName: "vc-jwt",

        // if you wish the publication date to be other than today, set this
        publishDate: "2023-04-27",

        // implementationReportURI: "https://w3c.github.io/vc-test-suite/implementations/",
        // errata: "https://w3c.github.io/vc-data-model/errata.html",
        // previousMaturity: "REC",
        // previousPublishDate: "2019-11-19",

        // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
        // and its maturity status
        // previousPublishDate:  "1977-03-15",
        // previousMaturity:  "WD",

        // extend the bibliography entries
        // localBiblio: vcwg.localBiblio,
        doJsonLd: true,

        // Uncomment these to use the respec extension that generates a list of
        //   normative statements:
        // preProcess: [],
        // postProcess: [],

        github: "https://github.com/w3c/vc-jwt/",
        includePermalinks: false,

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI: "https://w3c.github.io/vc-jwt/",

        // editors, add as many as you like
        // only "name" is required
        editors: [
          {
            name: "Orie Steele",
            company: "Transmute",
            companyURL: "https://transmute.industries",
            w3cid: 109171,
          },
          {
            name: "Michael Jones",
            url: "https://self-issued.info/",
            company: "independent",
            w3cid: 38745,
          },
	  {
            name: "Michael Prorock",
            company: "Mesur.io", companyURL: "https://mesur.io/",
            w3cid: 130636
          }
        ],
        // authors, add as many as you like.
        // This is optional, uncomment if you have authors as well as editors.
        // only "name" is required. Same format as editors.
        authors: [],

        maxTocLevel: 2,
        inlineCSS: true,

        license: "w3c-software-doc",
        xref: true, 
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
This specification defines how to secure Verifiable Credentials with JSON
Web Tokens (JWT) [RFC7519], which build on JSON Web Signatures (JWS)
[RFC7515]. This enables Verifiable Credentials to be easily integrated into ecosystems that already support JSON Web Tokens.
      </p>
    </section>
    <section id="sotd"></section>

    <section id="introduction">
      <h2>Introduction</h2>
      <p>
        JSON Web Token (JWT) [[RFC7519]] is a widely-used means of
        expressing
        <a data-cite="VC-DATA-MODEL#claims">claims</a> to be transferred between two parties. Providing a
        representation of the Verifiable Credentials Data Model for JWT allows
        existing systems and libraries to participate in the ecosystem described
        in Section <a data-cite="VC-DATA-MODEL#ecosystem-overview">ecosystem overview</a>. A JWT encodes a set of
        <a data-cite="VC-DATA-MODEL#claims">claims</a> as a JSON object that is contained in a JSON Web Signature
        (JWS) [[RFC7515]] and/or JSON Web Encryption (JWE) [[?RFC7516]]. For this specification, the use
        of JWE is out of scope.
      </p>

      <section>
        <h5>Verifiable Credentials Data Model</h5>
        <p>
          This specification describes how to secure media types 
          expressing Verifiable Credentials and Verifiable Presentations 
          as described in the [[VC-DATA-MODEL]], using JWTs [[RFC7519]].
        </p>
        <p class="note">
          The <code>application/vc+jwt</code> media type described in this specification defines
          an example of a unidirectional mapping to a base media type defined in 
          the [[VC-DATA-MODEL]]; see <a href="#example-mapping">Appendix A.4.1</a>.
        </p>
      </section>
    </section>



    <section>
      <h2>Securing JSON</h2>
      <p>
        This section
        provides guidance on how to use JSON [[RFC7159]] claimsets with JWT registered claims to construct
        a JWT that can be mapped to a verifiable credential.  This section also describes
        how to use content types and token types to distinguish different representations of verifiable credentials.
      </p>
      <p class="note">
        This representation relies on claims registered in the
        <a href="https://www.iana.org/assignments/jwt/jwt.xhtml#claims">IANA JSON Web Token Claims Registry</a> whenever possible.
      </p>
      <p class="note">
        Production of this representation does not use <code>vc+ld+json</code> as an input.
      </p>
      <section>
        <h2>Credential Header</h2>
        <p><a data-cite="rfc7519#section-5.1">typ</a> MUST use the media type <code>vc+jwt</code>.</p>
        <aside
          class="example"
          title="credential metadata (decoded JWT header)"
        >
          <pre data-include="./examples/vc-2.0/templates/vc+jwt/header.json" data-include-format="json"></pre>
        </aside>
      </section>
      <section>
        <h2>Credential</h2>
        <aside
          class="example"
          title="credential (decoded JWT payload)"
        >
          <pre data-include="./examples/vc-2.0/templates/vc+jwt/claimset.json" data-include-format="json"></pre>
        </aside>
        <p class="note">
          The <code>vc</code> and <code>vp</code> claims MUST NOT be present when the content type header parameter is set to <code>credential-claims-set+json</code>.
        </p>
      </section>
      <section>
        <h2>Verifiable Credential</h2>
        <aside
          class="example"
          title="verifiable credential"
        >
          <p>An encoded verifiable credential (using external proof).</p>
          <pre data-include="./examples/vc-2.0/vc+jwt.jose" data-include-format="text"></pre>
        </aside>
      </section>

    </section>

    <section>
      <h2>Securing JSON-LD</h2>
      <p>
        The use of Verifiable Credentials often involves the representation and exchange of structured 
        data in the form of JSON-LD. While JSON-LD provides a flexible and extensible format for 
        describing data, it is important to note that it also provides a linkage between the data structure
        and semantic meaning of data.
        </p>
        <p>
        This section outlines how JSON-LD encoded claimset can be secured using either JOSE or COSE.
      </p>
      <p>
                A benefit to this approach is that payloads can be made to conform directly to the [[VC-DATA-MODEL]]
        without any mapping or transformation.
      </p>
      <section>
        <h2>With JOSE</h2>
        <section>
          <h2>Securing JSON-LD VCs with JOSE</h2>
          <p>
            This section details how to secure data payloads with the type <code>application/vc+ld+json</code> 
            with JOSE.
          </p>
          <p>[[rfc7515]] MAY be used to secure this media type.</p>
          <p>
            When using this approach, the <code>typ</code> MUST be <code>vc+ld+jwt</code>
          </p>
          <p>When using this approach, the <code>cty</code> MUST be <code>vc+ld+json</code>
          </p>
          <p>
            See <a data-cite="rfc7515#section-4.1.10">Common JOSE Header Parameters</a> 
            for additional details regarding usage of <code>typ</code> and <code>cty</code>.
          </p>
          <section>
            <h2>Examples</h2>
            <section>
              <h2>Credential Header</h2>
              <aside
                class="example"
                title="verifiable credential header (decoded JWT header)"
              >
                <pre data-include="./examples/vc-2.0/templates/vc+ld+jwt/header.json" data-include-format="json"></pre>
              </aside>
            </section>
            <section>
              <h2>Credential</h2>
              <aside
                class="example"
                title="verifiable credential (decoded JWT claimset)"
              >
                <pre data-include="./examples/vc-2.0/templates/vc+ld+jwt/claimset.json" data-include-format="json"></pre>
              </aside>
            </section>
            <section>
              <h2>Verifiable Credential</h2>
              <aside
                class="example"
                title="verifiable credential (encoded as JWT)"
              >
                <pre data-include="./examples/vc-2.0/vc+ld+jwt.jose" data-include-format="json"></pre>
              </aside>
            </section>
        </section>
      </section>
        <section>
          <h2>Securing JSON-LD VPs with JOSE</h2>
          <p>
            This section details how to secure verifiable presentations with the type 
            <code>application/vp+ld+json</code> with JOSE.
          </p>
          <p>[[rfc7515]] MAY be used to secure this media type.</p>
          <p>When using this approach, the <code>typ</code> MUST be <code>vp+ld+jwt</code></p>
          <p>When using this approach, the <code>cty</code> MUST be <code>vp+ld+json</code></p>
          <p>
            See <a data-cite="rfc7515#section-4.1.10">Common JOSE Header Parameters</a> 
            for additional details regarding usage of <code>typ</code> and <code>cty</code>.
          </p>
          <section>
            <h2>Examples</h2>
            <section>
              <h2>Presentation Header</h2>
              <aside
                class="example"
                title="verifiable presentation header (decoded JWT header)"
              >
                <pre data-include="./examples/vc-2.0/templates/vp+ld+jwt/header.json" data-include-format="json"></pre>
              </aside>
            </section>
            <section>
              <h2>Presentation</h2>
              <aside
                class="example"
                title="verifiable presentation (decoded JWT claimset)"
              >
                <pre data-include="./examples/vc-2.0/templates/vp+ld+jwt/claimset.json" data-include-format="json"></pre>
              </aside>
            </section>
            <section>
              <h2>Verifiable Presentation</h2>
              <aside
                class="example"
                title="verifiable presentation"
              >
                <p>An encoded verifiable presentation (using external proof).</p>
                <pre data-include="./examples/vc-2.0/vp+ld+jwt.jose" data-include-format="text"></pre>
              </aside>
            </section>
          </section>
        </section>
      </section>
      <section>
        <h2>With COSE</h2>
        <p>
          COSE [[rfc8152]] is a common approach to encoding and securing information
          using CBOR [[rfc8949]]. Verifiable credentials MAY be secured using COSE [[rfc8152]] 
          and MUST be identified through use of content types as outlined in this section.
        </p>
        <section>
          <h2>Securing JSON-LD VCs with COSE</h2>
          <p>
            This section details how to secure data with the type <code>application/vc+ld+json</code> 
            with COSE.
          </p>
          <p>[[rfc8152]] MAY be used to secure this media type.</p>
          <p>When using this approach, the <code>type (TBD)</code> MUST be <code>vc+ld+cwt</code></p>
          <p>When using this approach, the <code>content type (3)</code> MUST be <code>application/vc+ld+json</code></p>
          <p>
            See <a data-cite="rfc9052#section-3.1">Common COSE Header Parameters</a> for additional details.
          </p>
          <p>See <a href="https://www.iana.org/assignments/cbor-tags/cbor-tags.xhtml">Concise Binary Object Representation (CBOR) Tags</a> for additional details.</p>
        </section>
        <p class="issue" data-number="67"></p>
      </section>
    </section>

<section id="conformance"></section>

<section>
  <h2>Privacy Considerations</h2>
  <p>
    Verifiable Credentials often contain sensitive information that needs to be protected 
    to ensure the privacy and security of organizations and individuals. This section outlines some privacy 
    considerations relevant to implementers and users.
  </p>
  <p>
    Implementers are advised to note and abide by all privacy considerations called out in the [[VC-DATA-MODEL]].
  </p>
  <p>
Implementers are additionally advised to reference the
<a href="https://www.rfc-editor.org/rfc/rfc7519#section-12">Privacy Consideration</a>
section of the JWT specification for privacy guidance.
  </p>
  <p>
    In addition to the privacy recommendations in the [[VC-DATA-MODEL]], the following
    considerations are given:
    <ul>
      <li>
        <p>
          Minimization of data: It is considered best practice for Verifiable Credentials to only contain the minimum amount 
          of data necessary to achieve their intended purpose. This helps to limit the amount 
          of sensitive information that is shared or stored unnecessarily.
        </p>
      </li>
      <li>
        <p>
          Informed consent: It is considered best practice that individuals be fully informed about how their data will be 
          used and provide the ability to consent to or decline the use of their data. 
          This helps to ensure that individuals maintain control over their own personal information.
        </p>
      </li>
      <li>
        <p>
          Data protection: It is considered best practice to protect Verifiable Credentials using strong encryption and other
          security measures to prevent unauthorized access, modification, or disclosure. 
        </p>
      </li>
    </ul>
  </p>
  <p>
    These considerations are not exhaustive, and implementers and users are advised to consult additional privacy 
    resources and best practices to ensure the privacy and security of Verifiable Credentials implemented
    using VC-JWT.
  </p>
</section>
<section>
  <h2>Security Considerations</h2>
  <p>
    This section outlines security considerations for implementers and 
    users of this specification.
    It is important to carefully consider these factors to ensure the security 
    and integrity of Verifiable Credentials when implemented using JWTs.
  </p>
  <p>
    When implementing VC-JWTs, it is essential to address all security issues relevant 
    to broad cryptographic applications. This especially includes protecting the user's
    asymmetric private and symmetric secret keys, as well as employing countermeasures 
    against various attacks. Failure to adequately address these issues could compromise 
    the security and integrity of Verifiable Credentials, potentially leading to unauthorized 
    access, modification, or disclosure of sensitive information. 
  </p>
  <p>
    Implementers are advised to follow best practices and established cryptographic standards to ensure 
    the secure handling of keys and other sensitive data. 
    Additionally, conduct regular security assessments and audits to identify and 
    address any vulnerabilities or threats.
  </p>
  <p>
    Follow all security considerations outlined in [[rfc7515]] and [[rfc7519]].
  </p>
  <p>
    When utilizing JSON-LD, take special care around remote retrieval of contexts and follow the
    additional security considerations noted in [[json-ld11]].
  </p>
  <p>
    As noted in [[rfc7515]] when utilizing JSON [[rfc7159]], strict validation is a security
    requirement. If malformed JSON is received, it may be impossible to reliably interpret the 
    producer's intent, potentially leading to ambiguous or exploitable situations.
    To prevent these risks, it is essential to use a JSON parser that strictly validates the syntax 
    of all input data. It is essential that any JSON inputs that do not conform to the JSON-text syntax defined in [[rfc7159]]
    be rejected in their entirety by JSON parsers. Failure to reject invalid input could compromise 
    the security and integrity of Verifiable Credentials.
  </p>
</section>

    <section class="appendix informative">
<h2>IANA Considerations</h2>
<section id="vc-jwt-media-type">
  <h2><code>application/vc+jwt</code></h2>
  <p>
    This specification registers the <code>application/vc+jwt</code> Media Type specifically for
    identifying a <a data-cite="rfc7519#section-3">JWT</a> conforming to the Verifiable Credentials JWT format in the `typ` header.
  </p>
  <table>
    <tr>
      <td>Type name: </td>
      <td>application</td>
    </tr>
    <tr>
      <td>Subtype name: </td>
      <td>application/vc+jwt</td>
    </tr>
    <tr>
      <td>Required parameters: </td>
      <td>None</td>
    </tr>
    <tr>
      <td>Encoding considerations: </td>
      <td>
        <code>application/vc+jwt</code> values are encoded
        as a series of base64url encoded values (some of which may be the
        empty string) each separated from the next by a single period
        ('.') character.
      </td>
    </tr>
    <tr>
      <td>Security considerations: </td>
      <td>
        <p>As defined in this specification. See also the security considerations in [[RFC7519]].</p>
      </td>
    </tr>
    <tr>
      <td>Contact: </td>
      <td>
        W3C Verifiable Credentials Working Group <a href="mailto:public-vc-wg@w3.org">public-vc-wg@w3.org</a>
      </td>
    </tr>
  </table>
</section>

<section id="vc-ld-jwt-media-type">
  <h2><code>application/vc+ld+jwt</code></h2>
  <p>
    This specification registers the <code>application/vc+ld+jwt</code> Media Type specifically for
    identifying a <a data-cite="rfc7519#section-3">JWT</a> conforming to the Verifiable Credentials JWT format in the `typ` header.
  </p>
  <table>
    <tr>
      <td>Type name: </td>
      <td>application</td>
    </tr>
    <tr>
      <td>Subtype name: </td>
      <td>vc+ld+jwt</td>
    </tr>
    <tr>
      <td>Required parameters: </td>
      <td>None</td>
    </tr>
    <tr>
      <td>Encoding considerations: </td>
      <td>
        <code>application/vc+ld+jwt</code> values are encoded
        as a series of base64url encoded values (some of which may be the
        empty string) each separated from the next by a single period
        ('.') character.
      </td>
    </tr>
    <tr>
      <td>Security considerations: </td>
      <td>
        <p>As defined in this specification. See also the security considerations in [[RFC7519]].</p>
      </td>
    </tr>
    <tr>
      <td>Contact: </td>
      <td>
        W3C Verifiable Credentials Working Group <a href="mailto:public-vc-wg@w3.org">public-vc-wg@w3.org</a>
      </td>
    </tr>
  </table>
</section>


<section id="credential-claims-set-1.1-media-type">
  <h2><code>application/credential-claims-set-1.1+json</code></h2>
  <p>
    This specification registers the <code>application/credential-claims-set-1.1+json</code> MIME Media Type specifically for
    identifying a <a href="https://www.rfc-editor.org/rfc/rfc7519#section-4">JWT Claims Set</a> conforming to the Verifiable Credentials 1.1 JWT format in the `cty` header.
  </p>
  <table>
    <tr>
      <td>Type name: </td>
      <td>application</td>
    </tr>
    <tr>
      <td>Subtype name: </td>
      <td>application/credential-claims-set-1.1+json</td>
    </tr>
    <tr>
      <td>Required parameters: </td>
      <td>None</td>
    </tr>
    <tr>
      <td>Encoding considerations: </td>
      <td>
        Resources that use the "<code>application/credential-claims-set-1.1+json</code>"
        Media Type are required to conform to all of the requirements
        for the "<code>application/json</code>" Media Type and are
        therefore subject to the same encoding considerations specified
        in Section 11 of [[RFC7159]].
      </td>
    </tr>
    <tr>
      <td>Security considerations: </td>
      <td>
        <p>As defined in this specification. See also the security considerations in [[RFC7519]].</p>
      </td>
    </tr>
    <tr>
      <td>Contact: </td>
      <td>
        W3C Verifiable Credentials Working Group <a href="mailto:public-vc-wg@w3.org">public-vc-wg@w3.org</a>
      </td>
    </tr>
  </table>
  <div class="issue" data-number="42"></div>
</section>

<section>
  <h2>Appendix</h2>
  <section>
    <h2>Example Mapping</h2>
    <p>
The following describes a mapping from <code>application/vc+jwt</code> to
<code>application/vc+ld+json</code>. This is one possible unidirectional mapping
between 2.0 VC-JWTs and the VC Data Model; other such mappings are possible.
    </p>
    <ul>
      <li>
Extract <code>iss</code>, <code>sub</code>, <code>iat</code>, <code>nbf</code>,
<code>exp</code>, <code>jti</code>, and <code>aud</code> as registered claims.
      </li>
      <li>
Set aside all other claims as subject claims.
      </li>
      <li>
To construct the VCDM-compliant JSON:
        <ul>
          <li>
Set the value of <code>@context</code> to
<code>"https://www.w3.org/ns/credentials/v2"</code>.
          </li>
          <li>
Set the value of <code>type</code> to <code>["VerifiableCredential"]</code>.
          </li>
          <li>
Set the value of the <code>issuer</code> property to one of the following:
          <ul>
            <li>
If the value of <code>iss</code> is a URL, use the value of <code>iss</code>.
            </li>
            <li>
If the value of <code>iss</code> is not a URL, use the concatenation of "<code>urn:vc:</code>"
and the value of <code>iss</code>.
            </li>
          </ul>
          </li>
          <li>
If <code>jti</code> is present, set the value of <code>id</code> to the
concatenation of "<code>urn:vc:</code>" and the value of <code>jti</code>.
          </li>
          <li>
If <code>nbf</code> is present, set the value of <code>validFrom</code> to the
<code>dateTime</code> obtained by converting the value of <code>nbf</code> from
the <code>NumericDate</code> described in [[!RFC7519]] to a <code>dateTime</code> as
described in [[XMLSCHEMA11-2]].
          </li>
          <li>
If <code>exp</code> is present, set the value of <code>validUntil</code> to the
<code>dateTime</code> obtained by converting the value of <code>exp</code> from
the <code>NumericDate</code> described in [[!RFC7519]] to a <code>dateTime</code> as
described in [[XMLSCHEMA11-2]].
          </li>
          <li>
Set the value of <code>credentialSubject</code> to an object that contains
the following properties:
          <ul>
            <li>
If <code>sub</code> is present, set the value of the <code>id</code> property to
the concatenation of "urn:vc:" and the value of <code>sub</code>.
            </li>
            <li>
Add all of the subject claims.
            </li>
          </ul>


          </li>
        </ul>
      </li>
    </ul>
    <aside
            class="example"
            title="application/vc+jwt mapped to application/vc+ld+json"
      >
      <p>A Verifiable Credential of type application/vc+jwt:</p>
        <pre data-include="./examples/vc-2.0/templates/vc+jwt/claimset.json" data-include-format="json"></pre>
      <p>The application/vc+ld+json after applying the mapping:</p>
        <pre data-include="./examples/vc-2.0/templates/vc+jwt/claimset.mapped.json" data-include-format="json"></pre>
      </aside>
  </section>
</section>


    </section>
  </body>
</html>
